@page
@using asp_presentacion.Pages
@model IndexModel
@{
    ViewData["Title"] = "Mercado - Productos";
}
@if (!Model.EstaLogueado)
{
    <!DOCTYPE html>
    <html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Mercado - Productos</title>
        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
        <style>
            .product-card {
                border: 1px solid #ddd;
                border-radius: 8px;
                overflow: hidden;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
                transition: box-shadow 0.3s ease-in-out;
                background-color: #fff;
                margin-bottom: 30px;
            }

                .product-card:hover {
                    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                }

            .product-image {
                width: 100%;
                height: 180px;
                object-fit: cover;
            }

            .product-info {
                padding: 15px;
                text-align: center;
            }

            .product-name {
                font-size: 1.2rem;
                font-weight: 600;
                margin-bottom: 8px;
                color: #333;
            }

            .product-price {
                font-size: 1.1rem;
                color: #198754; /* bootstrap green */
                font-weight: bold;
            }
        </style>
    </head>
    <body class="bg-light">

        <div class="container py-4">
            <h1 class="mb-4 text-center">Productos Disponibles</h1>
            <div class="row">
                @foreach (var producto in Model.Lista!)//Recore todos los elemntos de la lista
                {
                    <div class="col-sm-6 col-md-4 col-lg-3">
                        <div class="product-card">
                            <img src="data:image;base64,@System.Convert.ToBase64String(lib_dominio.Nucleo.EncodingHelper.ToBytes(producto.Imagen!))" alt="@producto.Nombre" class="product-image" />
                            <div class="product-info">
                                <div class="product-name">@producto.Nombre</div>
                                <div class="product-price">@producto.Precio_Venta</div>
                                <form method="post" asp-page-handler="BTComprar">
                                    <input type="hidden" name="data" value="@producto.ID" />
                                    <button type="submit" class="btn btn-primary">Comprar</button>
                                </form>
                            </div>
                        </div>
                    </div>
                }   

                 @if (Model.Actual != null)
                {
                    <form method="POST"
              enctype="multipart/form-data">
                    <div class="containers_vn panel panel-default">
                        <h3>Formulario de compra</h3>
                        <div>
                                <div class="form-group">
                                    <label class="col-lg-4 control-label">Tipo movimiento</label>
                                    <div class="col-lg-6">
                                        <select asp-for="@Model.Documento!.Tipo_Movimiento" class="form-control">
                                            <option value="">Seleccione una opción</option>
                                            <option value="Compra">Compra</option>
                                            <option value="Venta">Venta</option>
                                        </select>
                                    </div>
                                </div>

                            <div class="form-group">
                                <label class="col-lg-4 control-label">
                                    Producto
                                </label>
                                <div class="col-lg-6">
                                    <input id="nmEstudiante"
                                           class="cts_forms form-control"
                                           asp-for="@Model.Actual!.Nombre" readonly/>
                                            @* Obtiene el valor del ID del producto actual y se lo asigna a documentos *@
                                  <input type="hidden" asp-for="@Model.Documento!.ID_Producto" value="@Model.Actual.ID" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-lg-4 control-label">
                                    Cantidad
                                </label>
                                <div class="col-lg-6">
                                    <input id="nmEstudiante"
                                           class="cts_forms form-control"
                                           asp-for="@Model.Documento!.Cantidad" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-lg-4 control-label">
                                    Bodega
                                </label>
                                <div class="col-lg-6">
                                    <select id="nmBodegas"
                                            class="form-control"
                                            asp-for="@Model.Documento!.ID_Bodega"
                                            asp-items="@(new SelectList(Model.ListBodegas, "ID", "Nombre"))">
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-lg-4 control-label">
                                    Empresa
                                </label>
                                <div class="col-lg-6">
                                    <select id="nmBodegas"
                                            class="form-control"
                                            asp-for="@Model.Documento!.ID_Empresa"
                                            asp-items="@(new SelectList(Model.ListEmpresas, "ID", "Nombre"))">
                                    </select>
                                </div>
                            </div>
                            <input type="submit"
                                   value="Guardar"
                                   asp-page-handler="BtGuardar"
                                   class="btn btn-secondary" />
                                <input type="submit"
                                       value="Cerrar"
                                       asp-page-handler="BtCerrar"
                                       class="btn btn-secondary" />
                        </div>
                    </div>
                        @* Si se genera algun error muestre el mensaje en las ventanas emergentes *@
                        @if (ViewData.ContainsKey("Mensaje"))
                        {
                            <input type="hidden"
                                   asp-page-handler="BtCerrar" />
                            @await Html.PartialAsync("Emergentes/Mensajes.cshtml");
                        }
                    </form>
                } 

            </div>
        </div>
       

        <!-- Bootstrap JS Bundle -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    </body>
    </html>
}
