@page
@model asp_presentaciones.Pages.Ventanas.PedidosModel
@{
    ViewData["Title"] = "Pedidos";
}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Generar Pedido</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

@* <button class="btn btn-primary" type="submit">Botón</button>
<button class="btn btn-primary" type="submit">Botón</button> *@
    <div class="container">
        <div class="card shadow-sm">
            <div class="card-body">
                <h2 class="card-title mb-4">@ViewData["Title"]</h2>
                <!-- Formulario -->
                <form class="row g-3" method="POST"
                      enctype="multipart/form-data">
                    <!-- Documento -->
                    <div class="col-md-6">
                        <label for="documento" class="form-label">Documento</label>
                        <select id="documento"
                                class="form-select"
                                asp-for="@Model.Actual!.ID_Documentos"
                                asp-items="@(new SelectList(Model.ListDocumentos, "ID", "Codigo"))">
                        </select>
                    </div>

                    <!-- Vehículo -->
                    <div class="col-md-6">
                        <label for="vehiculo" class="form-label">Vehículo</label>
                        <select id="vehiculos"
                                class="form-select"
                                asp-for="@Model.Actual!.ID_Vehiculos"
                                asp-items="@(new SelectList(Model.ListVehiculos, "ID", "Placa"))">
                        </select>
                    </div>

                    <!-- Botón -->
                    <div class="col-12">
                        <button type="submit" class="btn btn-primary" asp-page-handler="BtGuardar">Generar Pedido</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Tabla de pedidos -->
        <div class="card mt-5 shadow-sm">
            <div class="card-body">
                <h4 class="card-title mb-3">Lista de Pedidos</h4>
                <div class="table-responsive">
                    <table class="table table-striped table-bordered">
                        <thead class="table-light">
                            <tr>
                                <th>Código</th>
                                <th>Estado del Pedido</th>
                                <th>Empresa</th>
                                <th>Vehículo</th>
                                <th>Accion</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model != null && Model.Lista != null)
                            {
                                @* Busca cada elemento de la lista que le mandaron lib?presentaciones *@
                                @foreach (var elemento in Model.Lista)
                                {
                                    <tr>
                                        <td>@elemento._Documentos!.Codigo</td>
                                        <td>@elemento._Documentos!.Estado</td>
                                        <td>@elemento._Documentos!.ID_Empresa</td>
                                        <td>@elemento._Vehiculos!.Placa</td>
                                        <td>
                                            <form method="POST"
                                                  enctype="multipart/form-data">
                                                <input type="submit"
                                                       value="Modicar"
                                                       asp-page-handler="BtModificar"
                                                       class="btn btn-secondary "
                                                       asp-route-data="@elemento.ID" />
                                            </form>
                                        </td>

                                    </tr>
                                }
                            }
                        </tbody>
                        @if(Model!.Actual != null)
                        {
                        <div id="contenedorFormulario" class="mt-3" style="display">
                            <form method="post" class="row g-3">
                                    @* Le manda la info de documentos para editarlo*@
                                    <input type="hidden" asp-for="@Model!.Documento!.ID" />
                                    <input type="hidden" asp-for="@Model!.Documento!.Tipo_Movimiento" />
                                    <input type="hidden" asp-for="@Model!.Documento!.Codigo" />
                                    <input type="hidden" asp-for="@Model!.Documento!.ID_Bodega" />
                                    <input type="hidden" asp-for="@Model!.Documento!.ID_Producto" />
                                    <input type="hidden" asp-for="@Model!.Documento!.Valor" />
                                    <input type="hidden" asp-for="@Model!.Documento!.Fecha" />
                                    <input type="hidden" asp-for="@Model!.Documento!.Cantidad" />
                                    <input type="hidden" asp-for="@Model!.Documento!.ID_Empresa" />
                                <div class="col-md-6">
                                    <label class="form-label" for="selectOpciones">Selecciona una opción</label>
                                        <select asp-for="@Model.Documento!.Estado" class="form-control">
                                            <option value="">Seleccione una opción</option>
                                            <option value="Pendiente">Pendiente</option>
                                            <option value="Transito">Transito</option>
                                            <option value="Asignado">Asignado</option>
                                            <option value="Entregado">Entregado</option>
                                        </select>
                                </div>
                                <div class="col-12">
                                    <button type="submit" class="btn btn-primary me-2" asp-page-handler="BtModificarDocumentos">Guardar</button>
                                     <button type="submit" class="btn btn-secondary" id="btnCancelarForm" asp-page-handler="BtCancelar">Cancelar</button>
                                </div>
                            </form>
                        </div>
                        }
                    </table>
                </div>
            </div>
        </div>
    </div>
    <form method="POST"
          enctype="multipart/form-data">
        @* Si se genera algun error muestre el mensaje en las ventanas emergentes *@
        @if (ViewData.ContainsKey("Mensaje"))
        {
            <input type="hidden"
                   asp-page-handler="BtCerrar" />
            @await Html.PartialAsync("../Emergentes/Mensajes.cshtml")
            ;
        }
    </form>
    @* <script>
        // Selecciona todos los botones
        document.querySelectorAll('.btnMostrarFormulario').forEach(boton => {
            boton.addEventListener('click', function (event) {
                event.preventDefault(); // Evita el submit real

                const contenedor = document.getElementById('contenedorFormulario');
                contenedor.style.display = 'block';

                const id = this.getAttribute('data-id'); // Aquí tienes el ID si lo necesitas
                console.log('Modificando elemento con ID:', id);

                // También podrías llenar un campo oculto con ese ID si deseas enviarlo
            });
        });

        // Botón cancelar
        document.getElementById('btnCancelarForm').addEventListener('click', () => {
            document.getElementById('contenedorFormulario').style.display = 'none';
        });
    </script> *@





    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
